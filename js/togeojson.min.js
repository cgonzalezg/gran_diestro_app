toGeoJSON=function(){"use strict";function e(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r}function t(e,t){return e.getElementsByTagName(t)}function r(e,t){return e.getAttribute(t)}function n(e,t){return parseFloat(r(e,t))}function o(e,r){var n=t(e,r);return n.length?n[0]:null}function i(e){return e.normalize&&e.normalize(),e}function u(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function a(e){var t={};for(var r in e)e[r]&&(t[r]=e[r]);return t}function l(e){return e&&i(e),e&&e.firstChild&&e.firstChild.nodeValue||""}function s(e){return u(e.replace(y,"").split(","))}function f(e){for(var t=e.replace(d,"").split(m),r=[],n=0;n<t.length;n++)r.push(s(t[n]));return r}function p(e){var t=[n(e,"lon"),n(e,"lat")],r=o(e,"ele");return r&&t.push(parseFloat(l(r))),t}function c(){return{type:"FeatureCollection",features:[]}}function g(e){return h.serializeToString(e)}var h,y=/\s*/g,d=/^\s*|\s*$/g,m=/\s+/;"undefined"!=typeof XMLSerializer?h=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(h=new(require("xmldom").XMLSerializer));var v={kml:function(n,i){function a(e){var t,r;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),(6===e.length||3===e.length)&&(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t=e.substr(2)),[t,isNaN(r)?void 0:r]}function p(e){return u(e.split(" "))}function h(e){for(var r=t(e,"coord","gx"),n=[],o=0;o<r.length;o++)n.push(p(l(r[o])));return n}function y(e){var r,n,i,u,a,p=[];if(o(e,"MultiGeometry"))return y(o(e,"MultiGeometry"));if(o(e,"MultiTrack"))return y(o(e,"MultiTrack"));for(i=0;i<S.length;i++)if(n=t(e,S[i]))for(u=0;u<n.length;u++)if(r=n[u],"Point"==S[i])p.push({type:"Point",coordinates:s(l(o(r,"coordinates")))});else if("LineString"==S[i])p.push({type:"LineString",coordinates:f(l(o(r,"coordinates")))});else if("Polygon"==S[i]){var c=t(r,"LinearRing"),g=[];for(a=0;a<c.length;a++)g.push(f(l(o(c[a],"coordinates"))));p.push({type:"Polygon",coordinates:g})}else"Track"==S[i]&&p.push({type:"LineString",coordinates:h(r)});return p}function d(e){var r,n=y(e),i={},u=l(o(e,"name")),s=l(o(e,"styleUrl")),f=l(o(e,"description")),p=o(e,"TimeSpan"),c=o(e,"ExtendedData"),g=o(e,"LineStyle"),h=o(e,"PolyStyle");if(!n.length)return[];if(u&&(i.name=u),s&&v[s]&&(i.styleUrl=s,i.styleHash=v[s]),f&&(i.description=f),p){var d=l(o(p,"begin")),m=l(o(p,"end"));i.timespan={begin:d,end:m}}if(g){var S=a(l(o(g,"color"))),k=S[0],b=S[1],L=parseFloat(l(o(g,"width")));k&&(i.stroke=k),isNaN(b)||(i["stroke-opacity"]=b),isNaN(L)||(i["stroke-width"]=L)}if(h){var N=a(l(o(h,"color"))),F=N[0],P=N[1],M=l(o(h,"fill")),w=l(o(h,"outline"));F&&(i.fill=F),isNaN(P)||(i["fill-opacity"]=P),M&&(i["fill-opacity"]="1"===M?1:0),w&&(i["stroke-opacity"]="1"===w?1:0)}if(c){var T=t(c,"Data"),x=t(c,"SimpleData");for(r=0;r<T.length;r++)i[T[r].getAttribute("name")]=l(o(T[r],"value"));for(r=0;r<x.length;r++)i[x[r].getAttribute("name")]=l(x[r])}return[{type:"Feature",geometry:1===n.length?n[0]:{type:"GeometryCollection",geometries:n},properties:i}]}i=i||{};for(var m=c(),v={},S=["Polygon","LineString","Point","Track"],k=t(n,"Placemark"),b=t(n,"Style"),L=0;L<b.length;L++)v["#"+r(b[L],"id")]=e(g(b[L])).toString(16);for(var N=0;N<k.length;N++)m.features=m.features.concat(d(k[N]));return m},gpx:function(e,r){function n(e,r){for(var n=t(e,r),o=[],i=0;i<n.length;i++)o.push(p(n[i]));return o}function i(e){for(var r=t(e,"trkseg"),o=[],i=0;i<r.length;i++)o.push(n(r[i],"trkpt"));return{type:"Feature",properties:f(e),geometry:{type:1===o.length?"LineString":"MultiLineString",coordinates:1===o.length?o[0]:o}}}function u(e){return{type:"Feature",properties:f(e),geometry:{type:"LineString",coordinates:n(e,"rtept")}}}function s(e){var t=f(e);return t.sym=l(o(e,"sym")),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:p(e)}}}function f(e){var t,r=["name","desc","author","copyright","link","time","keywords"],n={};for(t=0;t<r.length;t++)n[r[t]]=l(o(e,r[t]));return a(n)}var g,h=t(e,"trk"),y=t(e,"rte"),d=t(e,"wpt"),m=c();for(g=0;g<h.length;g++)m.features.push(i(h[g]));for(g=0;g<y.length;g++)m.features.push(u(y[g]));for(g=0;g<d.length;g++)m.features.push(s(d[g]));return m}};return v}(),"undefined"!=typeof module&&(module.exports=toGeoJSON);
